# 通过 JNI 调用 C++ 代码

JNI (Java Native Interface) allows implementing methods in C/C++, and use them in Java.

## 1. `HelloJNI.java`
```java
public class HelloJNI {
    static {
        // Load native library hello.dll (Windows) or libhello.so (Unixes) or libhello.jnilib
        //  at runtime
        // This library contains a native method called sayHello()
        System.loadLibrary("hello");
    }

    private native void sayHello();

    public static void main(String[] args) {
        new HelloJNI().sayHello();
    }
}
```

## 2. Compile the `HelloJNI.java` file and codegen `HelloJNI.h`
Before JDK 8, you need to compile the Java program using javac and generate C/C++ header using a dedicated javah utility, as follows. The javah utility is no longer available in JDK 10.
```shell
javac -h . HelloJNI.java

or 

javac HelloJNI.java && javah -jni HelloJNI
```

This gives you JNIExample.h (do not edit it manually!):
```c++
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class HelloJNI */

#ifndef _Included_HelloJNI
#define _Included_HelloJNI
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     HelloJNI
 * Method:    sayHello
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_HelloJNI_sayHello
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif
```


## 3. Create `HelloJNI.cpp`
```c++
#include <jni.h>
#include <iostream>
#include "HelloJNI.h"

using namespace std;

JNIEXPORT void JNICALL Java_HelloJNI_sayHello(JNIEnv* env, jobject thisObj) {
    cout << "Hello world from C++!" << endl;
}
```


## 4. compile C++ library
IMPORTANT: library extension should exactly be .jnilib (not .so!), and should have lib prefix, i.e. libhello.jnilib:
```shell
g++ -I ${JAVA_HOME}/include -o libhello.jnilib -shared HelloJNI.cpp -fPIC
```

## 5. execute the java class
Notice, we set java.library.path to current directory, where the libhello.jnilib was compiled to:
```shell
java -Djava.library.path=. HelloJNI

or 

java HelloJNI
```

